#pragma once

#include "Junia/Base.hpp"

namespace Junia
{
	#define BITFIELD(x) (1 << (x))

	enum class EventType
	{
		WindowResizeEvent,
		WindowMovedEvent,
		WindowCloseEvent,

		MouseButtonDownEvent,
		MouseButtonUpEvent,
		MouseMovedEvent,
		MouseScrollEvent,

		KeyboardKeyDownEvent,
		KeyboardKeyUpEvent
	};

	enum EventCategory
	{
		WindowEvent   = BITFIELD(0),
		InputEvent    = BITFIELD(1),
		MouseEvent    = BITFIELD(2),
		KeyboardEvent = BITFIELD(3)
	};

	class JE_API_IO Event
	{
		friend class EventDispatcher;

		public:
			virtual EventType GetType()      = 0;
			virtual uint8_t GetCategories()  = 0;
			virtual std::string ToString()   = 0;

			inline bool IsCategory(EventCategory cat)
			{
				return GetCategories() & cat;
			}

		protected:
			bool handled = false;
	};

	class JE_API_IO EventDispatcher
	{
	public:
	private:
		Event& ev;
	};

	// Events are !blocking!

	// Future: buffer events in (maybe) EventBus
//
//	enum class EventType
//	{
//		None = 0,
//		WindowClose, WindowResize, WindowFocus, WindowLostFocus, WindowMoved,
//		AppTick, AppUpdate, AppRender,
//		KeyPressed, KeyReleased,
//		MouseButtonPressed, MouseButtonReleased, MouseMoved, MouseScrolled
//	};
//
//#define BITFIELD(x) (1 << (x))
//
//	enum EventCategory
//	{
//		None = 0,
//		EventCategoryApplication    = BITFIELD(0),
//		EventCategoryInput          = BITFIELD(1),
//		EventCategoryKeyboard       = BITFIELD(2),
//		EventCategoryMouse          = BITFIELD(3)
//	};
//
//#define EVENT_CLASS_TYPE(type) static EventType GetStaticType() { return EventType::##type; }\
//								virtual EventType GetEventType() const override { return GetStaticType(); }\
//								virtual const char* GetName() const override { return #type; }
//
//#define EVENT_CLASS_CATEGORY(category) virtual int GetCategoryFlags() const override { return category; }
//
//	class JE_API_IO Event
//	{
//		friend class EventDispatcher;
//
//	public:
//		virtual EventType GetEventType() const = 0;
//		virtual const char* GetName() const = 0;
//		virtual int GetCategoryFlags() const = 0;
//		virtual std::string ToString() const { return GetName(); }
//
//		inline bool IsInCategory(EventCategory category)
//		{
//			return GetCategoryFlags() & category;
//		}
//
//	protected:
//		bool m_Handled = false;
//	};
//
//	class EventDispatcher
//	{
//		template<typename T>
//		using EventFn = std::function<bool(T&)>;
//
//	public:
//		EventDispatcher(Event& event) : m_Event(event) {}
//
//		template<typename T>
//		bool Dispatch(EventFn<T> func)
//		{
//			if (m_Event.GetEventType() == T::GetStaticType())
//			{
//				m_Event.m_Handled = func(*static_cast<T*>(&m_Event));
//				return true;
//			}
//			return false;
//		}
//
//	private:
//		Event& m_Event;
//	};
//
//	inline std::ostream& operator<<(std::ostream& os, const Event& e)
//	{
//		return os << e.ToString();
//	}
}